#!/usr/bin/env bash
# Install dig (part of dnsutils) if not present
if ! command -v dig &> /dev/null
then
    # Use 'apt-get' which is commonly available in these base images
    sudo apt-get update
    sudo apt-get install -y dnsutils
fi

# Function to get subdomain info and format the output
get_subdomain_info() {
    local domain=$1
    local subdomain=$2
    
    # Use dig to query the A record for the full domain
    # grep -E to filter for the ANSWER line containing the 'A' record (and ensure it's not a comment)
    # shellcheck disable=SC2086
    dig ${subdomain}.${domain} | grep -E '^[[:alnum:]].*\sA\s' | awk -v sd="$subdomain" '{
        # $4 is the record type (A)
        # $5 is the destination IP
        # sd is the passed subdomain (www, lb-01, etc.)
        printf "The subdomain %s is a %s record and points to %s\n", sd, $4, $5
    }'
}

# --- Main Script Logic ---
domain=$1
subdomain=$2

# If no subdomain provided, use default list
if [ -z "$subdomain" ]; then
    # Process the required subdomains in the specified order
    for sd in www lb-01 web-01 web-02; do
        get_subdomain_info "$domain" "$sd"
    done
else
    # Process the specified subdomain
    get_subdomain_info "$domain" "$subdomain"
fi
