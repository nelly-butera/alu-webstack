#!/usr/bin/env bash
# This script displays the DNS record type and IP address of specified subdomains

# Function to get subdomain info
get_subdomain_info() {
    local domain=$1
    local subdomain=$2
    
    # Use dig to get the full ANSWER line, excluding comments, then process with awk
    # shellcheck disable=SC2086
    dig ${subdomain}.${domain} | grep -E '^[^;].*\sA\s' | awk -v sd="$subdomain" '{
        # $4 is the record type (A)
        # $5 is the destination IP
        # sd is the passed subdomain (www, lb-01, etc.)
        printf "The subdomain %s is a %s record and points to %s\n", sd, $4, $5
    }'
}

# --- Main Script Logic ---
# Check if domain parameter is provided
if [ -z "$1" ]; then
    # Handle the case where the domain is missing, though the task says not to
    exit 1 
fi

domain=$1
subdomain=$2

# If no subdomain provided, use default list
if [ -z "$subdomain" ]; then
    # Process the required subdomains in the specified order
    for sd in www lb-01 web-01 web-02; do
        get_subdomain_info "$domain" "$sd"
    done
else
    # Process the specified subdomain
    get_subdomain_info "$domain" "$subdomain"
fi
